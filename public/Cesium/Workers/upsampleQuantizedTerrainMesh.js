define(["./AttributeCompression-f02ec82f","./Transforms-a73b3b3b","./Cartesian2-8417ca3d","./when-208fe5b0","./TerrainEncoding-73cbc4e6","./IndexDatatype-d47ad6f6","./Check-d18af7c4","./Math-4e53b694","./OrientedBoundingBox-18b4901f","./createTaskProcessorWorker","./RuntimeError-7f634f5d","./ComponentDatatype-9204e9f6","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-9123a53b","./IntersectionTests-7d224a2f","./Plane-4aa8974d"],(function(e,t,i,n,s,r,h,u,o,a,p,d,f,l,g,c){"use strict";var m=function(e,t,i,s,r,h){var u,o;n.defined(h)?h.length=0:h=[];var a,p,d,f,l,g,c=t?(u=i<e,o=s<e,r<e):(u=e<i,o=e<s,e<r);return 1===(t=u+o+c)?u?(a=(e-i)/(s-i),p=(e-i)/(r-i),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):o?(d=(e-s)/(r-s),f=(e-s)/(i-s),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==d&&(h.push(-1),h.push(1),h.push(2),h.push(d))):c&&(l=(e-r)/(i-r),g=(e-r)/(s-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==l&&(h.push(-1),h.push(2),h.push(0),h.push(l))):2===t?u||i===e?o||s===e?c||r===e||(p=(e-i)/(r-i),d=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(d)):(g=(e-r)/(s-r),a=(e-i)/(s-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(a)):(f=(e-s)/(i-s),l=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(l)):3!==t&&(h.push(0),h.push(1),h.push(2)),h},x=32767,w=16383,C=[],v=[],B=[],y=new i.Cartographic,b=new i.Cartesian3,I=[],z=[],M=[],N=[],V=[],A=new i.Cartesian3,E=new t.BoundingSphere,R=new o.OrientedBoundingBox,H=new i.Cartesian2,T=new i.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return(e=n.defined(e)?e:new O).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],this.second=i[e[++n]],this.ratio=e[++n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return n.defined(this.index)},O.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var U=new i.Cartesian2,F=-1,P=[new i.Cartesian3,new i.Cartesian3],S=[new i.Cartesian3,new i.Cartesian3];function k(t,n){var s=P[++F],r=S[F];s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r);return b=i.Cartesian3.lerp(s,r,t.ratio,b),i.Cartesian3.normalize(b,b),e.AttributeCompression.octEncode(b,n),--F,n}O.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(U=k(this,U)).x},O.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=k(this,U)).y};var D=[];function W(e,t,i,s,r,h,u,o,a){if(0!==u.length){for(var p=0,d=0;d<u.length;)d=D[p++].initializeFromClipResult(u,d,o);for(var f=0;f<p;++f){var l,g,c=D[f];c.isIndexed()?(c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,a&&(c.normalBuffer=s)):(l=c.getKey(),n.defined(h[l])?c.newIndex=h[l]:(g=e.length,e.push(c.getU()),t.push(c.getV()),i.push(c.getH()),a&&(s.push(c.getNormalX()),s.push(c.getNormalY())),c.newIndex=g,h[l]=g))}3===p?(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex)):4===p&&(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex),r.push(D[0].newIndex),r.push(D[2].newIndex),r.push(D[3].newIndex))}}return D.push(new O),D.push(new O),D.push(new O),D.push(new O),a((function(e,n){var h=e.isEastChild,a=e.isNorthChild,p=h?w:0,d=h?x:w,f=a?w:0,l=a?x:w,g=I,c=z,U=M,F=V;g.length=0,c.length=0,U.length=0,F.length=0;var P=N;P.length=0;for(var S={},k=e.vertices,D=(D=e.indices).subarray(0,e.indexCountWithoutSkirts),X=s.TerrainEncoding.clone(e.encoding),K=X.hasVertexNormals,Y=e.exaggeration,L=0,_=e.vertexCountWithoutSkirts,G=e.minimumHeight,J=e.maximumHeight,Z=new Array(_),j=new Array(_),q=new Array(_),Q=K?new Array(2*_):void 0,$=0,ee=0;$<_;++$,ee+=2){var te=X.decodeTextureCoordinates(k,$,H),ie=X.decodeHeight(k,$)/Y,ne=u.CesiumMath.clamp(te.x*x|0,0,x),se=u.CesiumMath.clamp(te.y*x|0,0,x);q[$]=u.CesiumMath.clamp((ie-G)/(J-G)*x|0,0,x),x-(ne=ne<20?0:ne)<20&&(ne=x),x-(se=se<20?0:se)<20&&(se=x),Z[$]=ne,j[$]=se,K&&(te=X.getOctEncodedNormal(k,$,T),Q[ee]=te.x,Q[ee+1]=te.y),(h&&w<=ne||!h&&ne<=w)&&(a&&w<=se||!a&&se<=w)&&(S[$]=L,g.push(ne),c.push(se),U.push(q[$]),K&&(F.push(Q[ee]),F.push(Q[ee+1])),++L)}var re=[];re.push(new O),re.push(new O),re.push(new O);var he=[];for(he.push(new O),he.push(new O),he.push(new O),$=0;$<D.length;$+=3){var ue=D[$],oe=D[$+1],ae=D[$+2],pe=Z[ue],de=Z[oe],fe=Z[ae];re[0].initializeIndexed(Z,j,q,Q,ue),re[1].initializeIndexed(Z,j,q,Q,oe),re[2].initializeIndexed(Z,j,q,Q,ae),(de=m(w,h,pe,de,fe,C)).length<=0||(fe=he[0].initializeFromClipResult(de,0,re))>=de.length||(fe=he[1].initializeFromClipResult(de,fe,re))>=de.length||(fe=he[2].initializeFromClipResult(de,fe,re),W(g,c,U,F,P,S,m(w,a,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K),fe<de.length&&(he[2].clone(he[1]),he[2].initializeFromClipResult(de,fe,re),W(g,c,U,F,P,S,m(w,a,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K)))}var le=h?-x:0,ge=a?-x:0,ce=[],me=[],xe=[],we=[],Ce=Number.MAX_VALUE,ve=-Ce,Be=B;Be.length=0;var ye=i.Ellipsoid.clone(e.ellipsoid),be=(Te=i.Rectangle.clone(e.childRectangle)).north,Ie=Te.south,ze=Te.east,Me=Te.west;for(ze<Me&&(ze+=u.CesiumMath.TWO_PI),$=0;$<g.length;++$)ne=(ne=Math.round(g[$]))<=p?(ce.push($),0):d<=ne?(xe.push($),x):2*ne+le,g[$]=ne,se=(se=Math.round(c[$]))<=f?(me.push($),0):l<=se?(we.push($),x):2*se+ge,c[$]=se,(ie=u.CesiumMath.lerp(G,J,U[$]/x))<Ce&&(Ce=ie),ve<ie&&(ve=ie),U[$]=ie,y.longitude=u.CesiumMath.lerp(Me,ze,ne/x),y.latitude=u.CesiumMath.lerp(Ie,be,se/x),y.height=ie,ye.cartographicToCartesian(y,b),Be.push(b.x),Be.push(b.y),Be.push(b.z);var Ne=t.BoundingSphere.fromVertices(Be,i.Cartesian3.ZERO,3,E),Ve=o.OrientedBoundingBox.fromRectangle(Te,Ce,ve,ye,R),Ae=(e=new s.EllipsoidalOccluder(ye).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Ne.center,Be,3,Ne.center,Ce,A),ve-Ce),Ee=new Uint16Array(g.length+c.length+U.length);for($=0;$<g.length;++$)Ee[$]=g[$];var Re=g.length;for($=0;$<c.length;++$)Ee[Re+$]=c[$];for(Re+=c.length,$=0;$<U.length;++$)Ee[Re+$]=x*(U[$]-Ce)/Ae;var He,Te=r.IndexDatatype.createTypedArray(g.length,P);return K?(He=new Uint8Array(F),n.push(Ee.buffer,Te.buffer,He.buffer),He=He.buffer):n.push(Ee.buffer,Te.buffer),{vertices:Ee.buffer,encodedNormals:He,indices:Te.buffer,minimumHeight:Ce,maximumHeight:ve,westIndices:ce,southIndices:me,eastIndices:xe,northIndices:we,boundingSphere:Ne,orientedBoundingBox:Ve,horizonOcclusionPoint:e}}))}));