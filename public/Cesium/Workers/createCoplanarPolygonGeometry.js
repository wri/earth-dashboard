define(["./arrayRemoveDuplicates-0f62a181","./BoundingRectangle-7ee12c46","./Transforms-a73b3b3b","./Cartesian2-8417ca3d","./Check-d18af7c4","./ComponentDatatype-9204e9f6","./CoplanarPolygonGeometryLibrary-6c63fe5e","./when-208fe5b0","./GeometryAttribute-04a19cfe","./GeometryAttributes-b0b294d8","./GeometryInstance-d919cab6","./GeometryPipeline-5e672526","./IndexDatatype-d47ad6f6","./Math-4e53b694","./PolygonGeometryLibrary-a62e716e","./PolygonPipeline-4d0ff0fe","./VertexFormat-e8cbf5b3","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./OrientedBoundingBox-18b4901f","./EllipsoidTangentPlane-9123a53b","./IntersectionTests-7d224a2f","./Plane-4aa8974d","./AttributeCompression-f02ec82f","./EncodedCartesian3-874933de","./ArcType-dc1c5aee","./EllipsoidRhumbLine-28521929"],(function(e,t,a,n,r,o,i,l,s,p,y,c,m,u,d,g,b,h,f,C,v,x,P,w,A,F,G){"use strict";var L=new n.Cartesian3,E=new t.BoundingRectangle,T=new n.Cartesian2,D=new n.Cartesian2,_=new n.Cartesian3,k=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,H=new a.Quaternion,B=new a.Matrix3,O=new a.Matrix3,z=new n.Cartesian3;function S(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(l.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}S.fromPositions=function(e){return new S({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},S.pack=function(e,t,a){return a=l.defaultValue(a,0),a=d.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,a),a+=b.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var N=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),Q=new b.VertexFormat,j={polygonHierarchy:{}};return S.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=d.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,N);t+=n.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,Q);t+=b.VertexFormat.packedLength;var s=e[t++];t=e[t];return(a=l.defined(a)?a:new S(j))._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=b.VertexFormat.clone(i,a._vertexFormat),a._stRotation=s,a.packedLength=t,a},S.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,b=t._stRotation,h=l.positions;if(!((h=e.arrayRemoveDuplicates(h,n.Cartesian3.equalsEpsilon,!0)).length<3)){var f=_,C=k,v=V,x=I,P=M;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(h,R,x,P)){f=n.Cartesian3.cross(x,P,f),f=n.Cartesian3.normalize(f,f),n.Cartesian3.equalsEpsilon(R,n.Cartesian3.ZERO,u.CesiumMath.EPSILON6)||(w=t._ellipsoid.geodeticSurfaceNormal(R,z),n.Cartesian3.dot(f,w)<0&&(f=n.Cartesian3.negate(f,f),x=n.Cartesian3.negate(x,x)));var w=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,x,P),A=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,x,P);r.tangent&&(C=n.Cartesian3.clone(x,C)),r.bitangent&&(v=n.Cartesian3.clone(P,v));w=(l=d.PolygonGeometryLibrary.polygonsFromHierarchy(l,w,!1)).hierarchy;var F=l.polygons;if(0!==w.length){h=w[0].outerRing,l=a.BoundingSphere.fromPoints(h);for(var G=d.PolygonGeometryLibrary.computeBoundingRectangle(f,A,h,b,E),S=[],N=0;N<F.length;N++){var Q=new y.GeometryInstance({geometry:function(e,t,r,i,l,y,c,d){var b=e.positions,h=g.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]),(e=m.IndexDatatype.createTypedArray(b.length,h.length)).set(h);var f=B;0!==i?(h=a.Quaternion.fromAxisAngle(y,i,H),f=a.Matrix3.fromQuaternion(h,f),(t.tangent||t.bitangent)&&(h=a.Quaternion.fromAxisAngle(y,-i,H),x=a.Matrix3.fromQuaternion(h,O),c=n.Cartesian3.normalize(a.Matrix3.multiplyByVector(x,c,c),c),t.bitangent&&(d=n.Cartesian3.normalize(n.Cartesian3.cross(y,c,d),d)))):f=a.Matrix3.clone(a.Matrix3.IDENTITY,f);var C=D;t.st&&(C.x=r.x,C.y=r.y);for(var v=b.length,x=3*v,P=new Float64Array(x),w=t.normal?new Float32Array(x):void 0,A=t.tangent?new Float32Array(x):void 0,F=t.bitangent?new Float32Array(x):void 0,G=t.st?new Float32Array(2*v):void 0,E=0,_=0,k=0,V=0,R=0,I=0;I<v;I++){var M,z=b[I];P[E++]=z.x,P[E++]=z.y,P[E++]=z.z,t.st&&(M=l(a.Matrix3.multiplyByVector(f,z,L),T),n.Cartesian2.subtract(M,C,M),z=u.CesiumMath.clamp(M.x/r.width,0,1),M=u.CesiumMath.clamp(M.y/r.height,0,1),G[R++]=z,G[R++]=M),t.normal&&(w[_++]=y.x,w[_++]=y.y,w[_++]=y.z),t.tangent&&(A[V++]=c.x,A[V++]=c.y,A[V++]=c.z),t.bitangent&&(F[k++]=d.x,F[k++]=d.y,F[k++]=d.z)}return x=new p.GeometryAttributes,t.position&&(x.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P})),t.normal&&(x.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.tangent&&(x.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.bitangent&&(x.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.st&&(x.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:x,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(F[N],r,G,b,A,f,C,v)});S.push(Q)}return(w=c.GeometryPipeline.combineInstances(S)[0]).attributes.position.values=new Float64Array(w.attributes.position.values),w.indices=m.IndexDatatype.createTypedArray(w.attributes.position.values.length/3,w.indices),h=w.attributes,r.position||delete h.position,new s.Geometry({attributes:h,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=S.unpack(e,t)),S.createGeometry(e)}}));