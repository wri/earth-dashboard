define(["./EllipsoidTangentPlane-9123a53b","./Transforms-a73b3b3b","./Cartesian2-8417ca3d","./when-208fe5b0","./TerrainEncoding-73cbc4e6","./Math-4e53b694","./OrientedBoundingBox-18b4901f","./RuntimeError-7f634f5d","./WebMercatorProjection-ffb6b9f8","./createTaskProcessorWorker","./Check-d18af7c4","./IntersectionTests-7d224a2f","./Plane-4aa8974d","./AttributeCompression-f02ec82f","./ComponentDatatype-9204e9f6","./WebGLConstants-76bb35d1"],(function(t,e,i,n,a,r,o,s,u,h,c,d,g,l,m,p){"use strict";var I=Uint16Array.BYTES_PER_ELEMENT,f=Int32Array.BYTES_PER_ELEMENT,E=Uint32Array.BYTES_PER_ELEMENT,T=Float32Array.BYTES_PER_ELEMENT,C=Float64Array.BYTES_PER_ELEMENT;function M(t,e,i){i=n.defaultValue(i,r.CesiumMath);for(var a=t.length,o=0;o<a;++o)if(i.equalsEpsilon(t[o],e,r.CesiumMath.EPSILON12))return o;return-1}var v=new i.Cartographic,N=new i.Cartesian3,b=new i.Cartesian3,x=new i.Cartesian3,S=new e.Matrix4;function w(t,a,o,s,u,h,c,d,g,l){for(var m=c.length,p=0;p<m;++p){var I=c[p],f=I.cartographic,E=I.index,T=t.length,C=f.longitude,M=f.latitude;M=r.CesiumMath.clamp(M,-r.CesiumMath.PI_OVER_TWO,r.CesiumMath.PI_OVER_TWO),f=f.height-h.skirtHeight;h.hMin=Math.min(h.hMin,f),i.Cartographic.fromRadians(C,M,f,v),g&&(v.longitude+=d),g?p===m-1?v.latitude+=l:0===p&&(v.latitude-=l):v.latitude+=d,M=h.ellipsoid.cartographicToCartesian(v),t.push(M),a.push(f),o.push(i.Cartesian2.clone(o[E])),0<s.length&&s.push(s[E]),e.Matrix4.multiplyByPoint(h.toENU,M,N),f=h.minimum,M=h.maximum,i.Cartesian3.minimumByComponent(N,f,f),i.Cartesian3.maximumByComponent(N,M,M),M=h.lastBorderPoint,n.defined(M)&&(M=M.index,u.push(M,T-1,T,T,E,M)),h.lastBorderPoint=I}}return h((function(h,c){h.ellipsoid=i.Ellipsoid.clone(h.ellipsoid),h.rectangle=i.Rectangle.clone(h.rectangle);var d=function(h,c,d,g,l,m,p,P,B,y){var A,R,_,W,F;yt=n.defined(g)?(A=g.west,R=g.south,_=g.east,W=g.north,F=g.width,g.height):(A=r.CesiumMath.toRadians(l.west),R=r.CesiumMath.toRadians(l.south),_=r.CesiumMath.toRadians(l.east),W=r.CesiumMath.toRadians(l.north),F=r.CesiumMath.toRadians(g.width),r.CesiumMath.toRadians(g.height));var O,Y,k=[R,W],U=[A,_],V=e.Transforms.eastNorthUpToFixedFrame(c,d),H=e.Matrix4.inverseTransformation(V,S);P&&(O=u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(R),Y=1/(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W)-O));var L=new DataView(h),D=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,j=b;j.x=Number.POSITIVE_INFINITY,j.y=Number.POSITIVE_INFINITY,j.z=Number.POSITIVE_INFINITY;var z=x;z.x=Number.NEGATIVE_INFINITY,z.y=Number.NEGATIVE_INFINITY,z.z=Number.NEGATIVE_INFINITY;var q,J,K=0,Q=0,X=0;for(J=0;J<4;++J){var Z=K;q=L.getUint32(Z,!0),Z+=E;var $=r.CesiumMath.toRadians(180*L.getFloat64(Z,!0));Z+=C,-1===M(U,$)&&U.push($),$=r.CesiumMath.toRadians(180*L.getFloat64(Z,!0)),Z+=C,-1===M(k,$)&&k.push($),Z+=2*C,$=L.getInt32(Z,!0),Z+=f,Q+=$,X+=3*($=L.getInt32(Z,!0)),K+=q+E}var tt=[],et=[],it=new Array(Q),nt=new Array(Q),at=new Array(Q),rt=P?new Array(Q):[],ot=new Array(X),st=[],ut=[],ht=[],ct=[],dt=0,gt=0;for(J=K=0;J<4;++J){q=L.getUint32(K,!0);var lt=K+=E,mt=r.CesiumMath.toRadians(180*L.getFloat64(K,!0));K+=C;var pt=r.CesiumMath.toRadians(180*L.getFloat64(K,!0));K+=C;var It=r.CesiumMath.toRadians(180*L.getFloat64(K,!0)),ft=.5*It;K+=C;var Et=r.CesiumMath.toRadians(180*L.getFloat64(K,!0)),Tt=.5*Et;K+=C;var Ct=L.getInt32(K,!0);K+=f;var Mt=L.getInt32(K,!0);K+=f,K+=f;for(var vt=new Array(Ct),Nt=0;Nt<Ct;++Nt){var bt=mt+L.getUint8(K++)*It;v.longitude=bt;var xt=pt+L.getUint8(K++)*Et;v.latitude=xt;var St=L.getFloat32(K,!0);if(K+=T,0!==St&&St<y&&(St*=-Math.pow(2,B)),St*=6371010*m,v.height=St,-1!==M(U,bt)||-1!==M(k,xt)){var wt=M(tt,v,i.Cartographic);if(-1!==wt){vt[Nt]=et[wt];continue}tt.push(i.Cartographic.clone(v)),et.push(dt)}vt[Nt]=dt,Math.abs(bt-A)<ft?st.push({index:dt,cartographic:i.Cartographic.clone(v)}):Math.abs(bt-_)<ft?ht.push({index:dt,cartographic:i.Cartographic.clone(v)}):Math.abs(xt-R)<Tt?ut.push({index:dt,cartographic:i.Cartographic.clone(v)}):Math.abs(xt-W)<Tt&&ct.push({index:dt,cartographic:i.Cartographic.clone(v)}),D=Math.min(St,D),G=Math.max(St,G),at[dt]=St,St=d.cartographicToCartesian(v),it[dt]=St,P&&(rt[dt]=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(xt)-O)*Y),e.Matrix4.multiplyByPoint(H,St,N),i.Cartesian3.minimumByComponent(N,j,j),i.Cartesian3.maximumByComponent(N,z,z),bt=(bt-A)/(_-A),bt=r.CesiumMath.clamp(bt,0,1),xt=(xt-R)/(W-R),xt=r.CesiumMath.clamp(xt,0,1),nt[dt]=new i.Cartesian2(bt,xt),++dt}for(var Pt=3*Mt,Bt=0;Bt<Pt;++Bt,++gt)ot[gt]=vt[L.getUint16(K,!0)],K+=I;if(q!==K-lt)throw new s.RuntimeError("Invalid terrain tile.")}it.length=dt,nt.length=dt,at.length=dt,P&&(rt.length=dt);var yt,At=dt;l=gt,h={hMin:D,lastBorderPoint:void 0,skirtHeight:p,toENU:H,ellipsoid:d,minimum:j,maximum:z};st.sort((function(t,e){return e.cartographic.latitude-t.cartographic.latitude})),ut.sort((function(t,e){return t.cartographic.longitude-e.cartographic.longitude})),ht.sort((function(t,e){return t.cartographic.latitude-e.cartographic.latitude})),ct.sort((function(t,e){return e.cartographic.longitude-t.cartographic.longitude})),w(it,at,nt,rt,ot,h,st,-(p=1e-5)*F,!0,-p*yt),w(it,at,nt,rt,ot,h,ut,-p*yt,!1),w(it,at,nt,rt,ot,h,ht,p*F,!0,p*yt),w(it,at,nt,rt,ot,h,ct,p*yt,!1),0<st.length&&0<ct.length&&(_t=st[0].index,Wt=ct[ct.length-1].index,yt=it.length-1,ot.push(Wt,yt,At,At,_t,Wt)),Q=it.length;var Rt,_t=e.BoundingSphere.fromPoints(it);n.defined(g)&&(Rt=o.OrientedBoundingBox.fromRectangle(g,D,G,d));for(var Wt=new a.EllipsoidalOccluder(d).computeHorizonCullingPointPossiblyUnderEllipsoid(c,it,D),Ft=(g=new t.AxisAlignedBoundingBox(j,z,c),new a.TerrainEncoding(g,h.hMin,G,V,!1,P)),Ot=new Float32Array(Q*Ft.getStride()),Yt=0,kt=0;kt<Q;++kt)Yt=Ft.encode(Ot,Yt,it[kt],nt[kt],at[kt],void 0,rt[kt]);return c=st.map((function(t){return t.index})).reverse(),g=ut.map((function(t){return t.index})).reverse(),h=ht.map((function(t){return t.index})).reverse(),V=ct.map((function(t){return t.index})).reverse(),g.unshift(h[h.length-1]),g.push(c[0]),V.unshift(c[c.length-1]),V.push(h[0]),{vertices:Ot,indices:new Uint16Array(ot),maximumHeight:G,minimumHeight:D,encoding:Ft,boundingSphere3D:_t,orientedBoundingBox:Rt,occludeePointInScaledSpace:Wt,vertexCountWithoutSkirts:At,indexCountWithoutSkirts:l,westIndicesSouthToNorth:c,southIndicesEastToWest:g,eastIndicesNorthToSouth:h,northIndicesWestToEast:V}}(h.buffer,h.relativeToCenter,h.ellipsoid,h.rectangle,h.nativeRectangle,h.exaggeration,h.skirtHeight,h.includeWebMercatorT,h.negativeAltitudeExponentBias,h.negativeElevationThreshold),g=d.vertices;return c.push(g.buffer),h=d.indices,c.push(h.buffer),{vertices:g.buffer,indices:h.buffer,numberOfAttributes:d.encoding.getStride(),minimumHeight:d.minimumHeight,maximumHeight:d.maximumHeight,boundingSphere3D:d.boundingSphere3D,orientedBoundingBox:d.orientedBoundingBox,occludeePointInScaledSpace:d.occludeePointInScaledSpace,encoding:d.encoding,vertexCountWithoutSkirts:d.vertexCountWithoutSkirts,indexCountWithoutSkirts:d.indexCountWithoutSkirts,westIndicesSouthToNorth:d.westIndicesSouthToNorth,southIndicesEastToWest:d.southIndicesEastToWest,eastIndicesNorthToSouth:d.eastIndicesNorthToSouth,northIndicesWestToEast:d.northIndicesWestToEast}}))}));