define(["./AttributeCompression-f02ec82f","./EllipsoidTangentPlane-9123a53b","./Transforms-a73b3b3b","./Cartesian2-8417ca3d","./when-208fe5b0","./TerrainEncoding-73cbc4e6","./IndexDatatype-d47ad6f6","./Math-4e53b694","./OrientedBoundingBox-18b4901f","./Check-d18af7c4","./WebMercatorProjection-ffb6b9f8","./createTaskProcessorWorker","./IntersectionTests-7d224a2f","./Plane-4aa8974d","./RuntimeError-7f634f5d","./ComponentDatatype-9204e9f6","./WebGLConstants-76bb35d1"],(function(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m,g,T){"use strict";function p(){c.DeveloperError.throwInstantiationError()}Object.defineProperties(p.prototype,{errorEvent:{get:c.DeveloperError.throwInstantiationError},credit:{get:c.DeveloperError.throwInstantiationError},tilingScheme:{get:c.DeveloperError.throwInstantiationError},ready:{get:c.DeveloperError.throwInstantiationError},readyPromise:{get:c.DeveloperError.throwInstantiationError},hasWaterMask:{get:c.DeveloperError.throwInstantiationError},hasVertexNormals:{get:c.DeveloperError.throwInstantiationError},availability:{get:c.DeveloperError.throwInstantiationError}});var f=[];p.getRegularGridIndices=function(e,t){var r=f[e];i.defined(r)||(f[e]=r=[]);var n=r[t];return i.defined(n)||N(e,t,n=e*t<s.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var E=[];p.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=E[e];i.defined(r)||(E[e]=r=[]);var n,o,a,s,d=r[t];return i.defined(d)||(n=p.getRegularGridIndices(e,t),o=(s=v(e,t)).westIndicesSouthToNorth,a=s.southIndicesEastToWest,e=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,d=r[t]={indices:n,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:e,northIndicesWestToEast:s}),d};var y=[];function v(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function N(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,c=i+1;r[n++]=i,r[n++]=s,r[n++]=c,r[n++]=c,r[n++]=s,r[n++]=d,++i}++i}}function w(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}p.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=y[e];i.defined(r)||(y[e]=r=[]);var n,o,s,d,c,u,h,l,I=r[t];return i.defined(I)||(s=(n=e*t)+(u=2*e+2*t),l=(o=(e-1)*(t-1)*6)+6*Math.max(0,u-4),d=(h=v(e,t)).westIndicesSouthToNorth,c=h.southIndicesEastToWest,u=h.eastIndicesNorthToSouth,h=h.northIndicesWestToEast,N(e,t,l=a.IndexDatatype.createTypedArray(s,l),0),p.addSkirtIndices(d,c,u,h,n,l,o),I=r[t]={indices:l,westIndicesSouthToNorth:d,southIndicesEastToWest:c,eastIndicesNorthToSouth:u,northIndicesWestToEast:h,indexCountWithoutSkirts:o}),I},p.addSkirtIndices=function(e,t,r,n,i,o,a){a=w(e,i,o,a),a=w(t,i+=e.length,o,a),a=w(r,i+=t.length,o,a),w(n,i+=r.length,o,a)},p.heightmapTerrainQuality=.25,p.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*p.heightmapTerrainQuality/(t*r)},p.prototype.requestTileGeometry=c.DeveloperError.throwInstantiationError,p.prototype.getLevelMaximumGeometricError=c.DeveloperError.throwInstantiationError,p.prototype.getTileDataAvailable=c.DeveloperError.throwInstantiationError,p.prototype.loadTileDataAvailability=c.DeveloperError.throwInstantiationError;var x=new n.Cartesian3,b=new n.Cartesian3,M=new n.Cartesian3,C=new n.Cartographic,S=new n.Cartesian2,A=new n.Cartesian3,P=new r.Matrix4,W=new r.Matrix4;function D(e,t,i,o,a,d,c,u,h){var l=Number.POSITIVE_INFINITY,I=a.north,m=a.south,g=a.east,T=a.west;g<T&&(g+=s.CesiumMath.TWO_PI);for(var p=e.length,f=0;f<p;++f){var E=i[y=e[f]],y=o[y];C.longitude=s.CesiumMath.lerp(T,g,y.x),C.latitude=s.CesiumMath.lerp(m,I,y.y),C.height=E-t,E=d.cartographicToCartesian(C,x),r.Matrix4.multiplyByPoint(c,E,E),n.Cartesian3.minimumByComponent(E,u,u),n.Cartesian3.maximumByComponent(E,h,h),l=Math.min(l,C.height)}return l}function B(t,o,a,d,c,h,l,I,m,g,T,p,f,E,y){var v=i.defined(l),N=m.north,w=m.south,b=m.east,M=m.west;b<M&&(b+=s.CesiumMath.TWO_PI);for(var D=a.length,B=0;B<D;++B){var F=a[B],k=c[F],V=h[F];C.longitude=s.CesiumMath.lerp(M,b,V.x)+E,C.latitude=s.CesiumMath.lerp(w,N,V.y)+y,C.height=k-g;var _,H,O=I.cartographicToCartesian(C,x);v&&(S.x=l[_=2*F],S.y=l[1+_],1!==T&&(k=e.AttributeCompression.octDecode(S.x,S.y,A),F=r.Transforms.eastNorthUpToFixedFrame(x,I,W),_=r.Matrix4.inverseTransformation(F,P),r.Matrix4.multiplyByPointAsVector(_,k,k),k.z*=T,n.Cartesian3.normalize(k,k),r.Matrix4.multiplyByPointAsVector(F,k,k),n.Cartesian3.normalize(k,k),e.AttributeCompression.octEncode(k,S))),d.hasWebMercatorT&&(H=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-p)*f),o=d.encode(t,o,O,V,C.height,S,H)}}function F(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),(r=i.defined(r)?r:Array.prototype.slice.call(e)).sort(t),r}return h((function(c,h){var l,I,m=(be=c.quantizedVertices).length/3,g=c.octEncodedNormals,T=c.westIndices.length+c.eastIndices.length+c.southIndices.length+c.northIndices.length,f=c.includeWebMercatorT,E=n.Rectangle.clone(c.rectangle),y=E.west,v=E.south,N=E.east,w=E.north,k=n.Ellipsoid.clone(c.ellipsoid),V=c.exaggeration,_=c.minimumHeight*V,H=c.maximumHeight*V,O=c.relativeToCenter,G=r.Transforms.eastNorthUpToFixedFrame(O,k),Y=r.Matrix4.inverseTransformation(G,new r.Matrix4);f&&(l=u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(v),I=1/(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(w)-l));var z=be.subarray(0,m),R=be.subarray(m,2*m),L=be.subarray(2*m,3*m),U=i.defined(g),j=new Array(m),q=new Array(m),Q=new Array(m),K=f?new Array(m):[],X=b;X.x=Number.POSITIVE_INFINITY,X.y=Number.POSITIVE_INFINITY,X.z=Number.POSITIVE_INFINITY;var Z=M;Z.x=Number.NEGATIVE_INFINITY,Z.y=Number.NEGATIVE_INFINITY,Z.z=Number.NEGATIVE_INFINITY;for(var J=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,ee=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,re=0;re<m;++re){var ne=z[re],ie=R[re],oe=ne/32767,ae=ie/32767;ne=s.CesiumMath.lerp(_,H,L[re]/32767);C.longitude=s.CesiumMath.lerp(y,N,oe),C.latitude=s.CesiumMath.lerp(v,w,ae),C.height=ne,J=Math.min(C.longitude,J),$=Math.max(C.longitude,$),ee=Math.min(C.latitude,ee),te=Math.max(C.latitude,te),ie=k.cartographicToCartesian(C),j[re]=new n.Cartesian2(oe,ae),q[re]=ne,Q[re]=ie,f&&(K[re]=(u.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C.latitude)-l)*I),r.Matrix4.multiplyByPoint(Y,ie,x),n.Cartesian3.minimumByComponent(x,X,X),n.Cartesian3.maximumByComponent(x,Z,Z)}var se,de,ce,ue=F(c.westIndices,(function(e,t){return j[e].y-j[t].y})),he=F(c.eastIndices,(function(e,t){return j[t].y-j[e].y})),le=F(c.southIndices,(function(e,t){return j[t].x-j[e].x})),Ie=F(c.northIndices,(function(e,t){return j[e].x-j[t].x}));1!==V&&(de=r.BoundingSphere.fromPoints(Q),se=d.OrientedBoundingBox.fromRectangle(E,_,H,k)),(1!==V||_<0)&&(ce=new o.EllipsoidalOccluder(k).computeHorizonCullingPointPossiblyUnderEllipsoid(O,Q,_));var me=_;me=Math.min(me,D(c.westIndices,c.westSkirtHeight,q,j,E,k,Y,X,Z));me=Math.min(me,D(c.southIndices,c.southSkirtHeight,q,j,E,k,Y,X,Z)),me=Math.min(me,D(c.eastIndices,c.eastSkirtHeight,q,j,E,k,Y,X,Z)),me=Math.min(me,D(c.northIndices,c.northSkirtHeight,q,j,E,k,Y,X,Z));for(var ge,Te,pe,fe=new t.AxisAlignedBoundingBox(X,Z,O),Ee=new o.TerrainEncoding(fe,me,H,G,U,f),ye=Ee.getStride(),ve=new Float32Array(m*ye+T*ye),Ne=0,we=0;we<m;++we)U&&(S.x=g[pe=2*we],S.y=g[1+pe],1!==V&&(ge=e.AttributeCompression.octDecode(S.x,S.y,A),Te=r.Transforms.eastNorthUpToFixedFrame(Q[we],k,W),pe=r.Matrix4.inverseTransformation(Te,P),r.Matrix4.multiplyByPointAsVector(pe,ge,ge),ge.z*=V,n.Cartesian3.normalize(ge,ge),r.Matrix4.multiplyByPointAsVector(Te,ge,ge),n.Cartesian3.normalize(ge,ge),e.AttributeCompression.octEncode(ge,S))),Ne=Ee.encode(ve,Ne,Q[we],j[we],q[we],S,K[we]);var xe=Math.max(0,2*(T-4)),be=c.indices.length+3*xe;return(fe=a.IndexDatatype.createTypedArray(m+T,be)).set(c.indices,0),xe=me=1e-4*($-J),be=-(T=G=1e-4*(te-ee)),B(ve,G=m*ye,ue,Ee,q,j,g,k,E,c.westSkirtHeight,V,l,I,-me,0),B(ve,G+=c.westIndices.length*ye,le,Ee,q,j,g,k,E,c.southSkirtHeight,V,l,I,0,be),B(ve,G+=c.southIndices.length*ye,he,Ee,q,j,g,k,E,c.eastSkirtHeight,V,l,I,xe,0),B(ve,G+=c.eastIndices.length*ye,Ie,Ee,q,j,g,k,E,c.northSkirtHeight,V,l,I,0,T),p.addSkirtIndices(ue,le,he,Ie,m,fe,c.indices.length),h.push(ve.buffer,fe.buffer),{vertices:ve.buffer,indices:fe.buffer,westIndicesSouthToNorth:ue,southIndicesEastToWest:le,eastIndicesNorthToSouth:he,northIndicesWestToEast:Ie,vertexStride:ye,center:O,minimumHeight:_,maximumHeight:H,boundingSphere:de,orientedBoundingBox:se,occludeePointInScaledSpace:ce,encoding:Ee,indexCountWithoutSkirts:c.indices.length}}))}));